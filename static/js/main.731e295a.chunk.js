(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,n){},106:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(43),c=n.n(o),s=(n(101),n(4)),i=n(5),u=n(7),l=n(6),h=n(8),f=function(){function e(){Object(s.a)(this,e)}return Object(i.a)(e,null,[{key:"getJSON",value:function(){if(!window.localStorage)return console.error("browser does not support local storage"),{};var e=window.localStorage.getItem("nash-hot-searches")||"{}";return JSON.parse(e)}},{key:"get",value:function(e){return this.getJSON()[e]}},{key:"set",value:function(e,t){var n=this.getJSON();n[e]=t,window.localStorage.setItem("nash-hot-searches",JSON.stringify(n))}},{key:"delete",value:function(e){var t=this.getJSON();delete t[e],window.localStorage.setItem("nash-hot-searches",JSON.stringify(t))}}]),e}(),m=n(13),y=n.n(m),p=n(18),d=function(){function e(t,n){Object(s.a)(this,e),this.appToken=t,this.baseUrl=n}return Object(i.a)(e,[{key:"urlFor",value:function(e){return"".concat(this.baseUrl).concat(e||"")}},{key:"get",value:function(){var e=Object(p.a)(y.a.mark(function e(t,n){var r,a,o,c,s,i,u;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.urlFor(t),a=f.get("cached-urls")||{},o=f.get("cached-responses")||{},c=new Date,!a[r]){e.next=9;break}if(s=new Date(a[r]),l=c,h=s,!(Math.abs(l.getTime()-h.getTime())/864e5<=1)){e.next=9;break}return console.log("using cached data for",r),e.abrupt("return",o[r]);case 9:return console.log("GET",r),e.next=12,window.fetch(r,{method:"GET",headers:{"Content-Type":"application/json","X-App-Token":this.appToken}});case 12:return i=e.sent,e.next=15,i.json();case 15:return u=e.sent,o[r]=n(u),a[r]=c,f.set("cached-urls",a),f.set("cached-responses",o),e.abrupt("return",o[r]);case 21:case"end":return e.stop()}var l,h},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),v=function(){function e(t){Object(s.a)(this,e),t.query_count?this.count=parseInt(t.query_count,10):this.count=t.count,this.query=t.query_text||t.query,this.year=parseInt(t.year,10),this.month=t.month_name||t.month}return Object(i.a)(e,[{key:"date",value:function(){if(this.year&&this.month)return new Date(this.year,function(e){switch(e.toLowerCase()){case"january":return 0;case"february":return 1;case"march":return 2;case"april":return 3;case"may":return 4;case"june":return 5;case"july":return 6;case"august":return 7;case"september":return 8;case"october":return 9;case"november":return 10;default:return 11}}(this.month),1)}},{key:"compareDate",value:function(e){var t=this.date(),n=e.date();return t<n?-1:t>n?1:0}},{key:"matches",value:function(e){var t=e.year;return this.matchesYear(t)}},{key:"matchesYear",value:function(e){return e&&this.year.toString()===e||"all"===e}}]),e}(),b="https://data.nashville.gov/resource/fuaa-r5cm.json",g=function(e){function t(e){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e,b))}return Object(h.a)(t,e),Object(i.a)(t,[{key:"getMonthlySearches",value:function(){var e=Object(p.a)(y.a.mark(function e(){var t,n,r,a;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=encodeURIComponent("year DESC"),n="?$limit=50000&$order=".concat(t),r=function(e){return e.map(function(e){return new v(e)})},e.next=5,this.get(n,r);case 5:return a=e.sent,e.abrupt("return",a.map(function(e){return new v(e)}).sort(function(e,t){return t.compareDate(e)}));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(d),j=n(45),O=(n(105),n(106),function(e){var t=e.original;return a.a.createElement("div",{className:"text-center"},t.month," ",t.year)}),S=function(e,t){return e.compareDate(t)},w=function(e){var t=e.value;return a.a.createElement("div",{className:"text-center"},t)},k=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.monthlySearches;return e.length<1?null:a.a.createElement(j.a,{filterable:!0,data:e,columns:[{Header:"Query",accessor:"query",headerClassName:"text-bold",Cell:w},{Header:"Count",accessor:"count",filterable:!1,headerClassName:"text-bold",Cell:w},{Header:"Date",id:"date",filterable:!1,accessor:function(e){return e},headerClassName:"text-bold",Cell:O,sortMethod:S}],pageSize:10,showPageSizeOptions:!1,className:"-striped -highlight"})}}]),t}(r.Component),E=function(){function e(){Object(s.a)(this,e)}return Object(i.a)(e,null,[{key:"uniq",value:function(e){if(!e)return e;var t={},n=function(e){return e.toString()},r={},a=!0,o=!1,c=void 0;try{for(var s,i=e[Symbol.iterator]();!(a=(s=i.next()).done);a=!0){var u=s.value,l=n(u);r[l]=u,t[l]=1}}catch(h){o=!0,c=h}finally{try{a||null==i.return||i.return()}finally{if(o)throw c}}return Object.keys(t).map(function(e){return r[e]})}}]),e}(),x=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).onChange=function(e){n.props.onChange(e.target.value)},n}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.allYears,n=e.selectedYear,r=E.uniq(t.sort()).reverse();return a.a.createElement("div",null,a.a.createElement("label",{htmlFor:"year",className:"mr-1"},"Year:"),a.a.createElement("select",{id:"year",className:"form-select",onChange:this.onChange,value:n},a.a.createElement("option",{value:"all"},"All"),r.map(function(e){return a.a.createElement("option",{value:e,key:e},function(e,t){var n=t.filter(function(t){return t.toString()===e.toString()}).length;return"".concat(e," (").concat(n,")")}(e,t))})))}}]),t}(r.Component),N=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.monthlySearches,n=e.onYearChange,r=e.year,o=t.map(function(e){return e.year});return a.a.createElement("form",{className:"flex-auto flex-justify-end d-flex flex-items-center"},a.a.createElement(x,{onChange:n,selectedYear:r,allYears:o}))}}]),t}(r.Component),C=(n(159),function(e){var t=function(e){var t={},n=!0,r=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var s=o.value,i="".concat(s.month," ").concat(s.year);i in t?t[i].push(s):t[i]=[s]}}catch(u){r=!0,a=u}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}return t}(e.reverse()),n=[];for(var r in t){var a=t[r],o={month:r},c=E.uniq(a.map(function(e){return e.query})),s=!0,i=!1,u=void 0;try{for(var l,h=function(){var e=l.value;o[e]=a.filter(function(t){return t.query===e}).map(function(e){return e.count}).reduce(function(e,t){return e+t})},f=c[Symbol.iterator]();!(s=(l=f.next()).done);s=!0)h()}catch(m){i=!0,u=m}finally{try{s||null==f.return||f.return()}finally{if(i)throw u}}n.push(o)}return n}),M=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.monthlySearches,t=C(e),n=function(e){return E.uniq(e.map(function(e){return e.query})).map(function(e){return{key:e,fill:"#ff00ff"}})}(e);return console.log(n),console.log(t),null}}]),t}(r.Component),q=n(44),T=(n(157),"year"),D=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).filterMonthlySearches=function(e,t){return e.filter(function(e){return e.matches(t)})},n.onDataLoaded=function(e){n.setState(function(t){var r=f.get(T)||t.year||"all";return{monthlySearches:e,isLoading:!1,year:r,filteredMonthlySearches:n.filterMonthlySearches(e,{year:r})}})},n.onYearChange=function(e){f.set(T,e),n.setState(function(t){return{year:e,filteredMonthlySearches:n.filterMonthlySearches(t.monthlySearches,{year:e})}})},n.state={monthlySearches:[],isLoading:!0,filteredMonthlySearches:[]},n}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){new g(q.socrataApi.appToken).getMonthlySearches().then(this.onDataLoaded)}},{key:"render",value:function(){var e=this.state,t=e.filteredMonthlySearches,n=e.monthlySearches,r=e.isLoading,o=e.year;return a.a.createElement("div",null,a.a.createElement("header",{className:"site-header"},a.a.createElement("div",{className:"container-lg py-3 d-flex flex-items-center flex-justify-between"},a.a.createElement("h1",{className:"f3 text-normal"},"Nashville.gov Top Searches"),r?null:a.a.createElement(N,{monthlySearches:n,onYearChange:this.onYearChange,year:o}))),a.a.createElement("main",{className:"site-main"},a.a.createElement("div",{className:"container-lg"},r?null:a.a.createElement(M,{monthlySearches:t}),a.a.createElement(k,{monthlySearches:t}))),a.a.createElement("footer",{className:"site-footer"},a.a.createElement("div",{className:"container-lg text-small py-4 d-flex flex-items-center flex-justify-between"},a.a.createElement("a",{target:"_blank",className:"link-gray",rel:"noopener noreferrer",href:"https://github.com/cheshire137/nash-hot-searches"},"View source"),a.a.createElement("span",null,"Data from ",a.a.createElement("a",{target:"_blank",className:"link-gray",rel:"noopener noreferrer",href:"https://data.nashville.gov/Public-Services/Nashville-gov-Top-500-Monthly-Searches/fuaa-r5cm"},"Nashville.gov - Top 500 Monthly Searches")))))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},44:function(e){e.exports={socrataApi:{appToken:"MqE8MXblHyd0rfJ7EsKhLPsih"}}},95:function(e,t,n){e.exports=n(158)}},[[95,1,2]]]);
//# sourceMappingURL=main.731e295a.chunk.js.map